<!DOCTYPE html>
<html lang="pt-br">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Agenda Fácil - Espaço Klebylenne Moraes</title>

<link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600&display=swap" rel="stylesheet">

<style>
/* SEU ESTILO ORIGINAL PRESERVADO */
body {
    margin: 0;
    font-family: 'Poppins', sans-serif;
    background: linear-gradient(135deg, #f8e8ee, #e3f2fd);
    display: flex;
    justify-content: center;
    padding: 20px;
}

.container {
    background: white;
    width: 100%;
    max-width: 500px;
    border-radius: 20px;
    padding: 25px;
    box-shadow: 0 10px 30px rgba(0,0,0,0.1);
}

h1 {
    text-align: center;
    color: #7b5ea7;
    margin-bottom: 20px;
}

label {
    font-size: 14px;
    font-weight: 500;
    color: #555;
}

input, select, button {
    width: 100%;
    padding: 12px;
    margin-top: 6px;
    margin-bottom: 15px;
    border-radius: 10px;
    border: 1px solid #ddd;
    font-size: 14px;
    box-sizing: border-box;
}

button {
    background-color: #7b5ea7;
    color: white;
    border: none;
    font-weight: 600;
    cursor: pointer;
    transition: 0.3s;
}

button:hover {
    background-color: #684a91;
}

.agendamentos {
    margin-top: 20px;
}

.card {
    background: #fdf4ff;
    padding: 12px;
    border-radius: 12px;
    margin-bottom: 10px;
    font-size: 13px;
    display: flex;
    justify-content: space-between;
    align-items: center;
}

.card button {
    width: auto;
    padding: 6px 10px;
    font-size: 11px;
    background: #ff6b81;
    margin: 0;
}

.footer {
    text-align: center;
    font-size: 12px;
    margin-top: 20px;
    color: #999;
}
</style>
</head>

<body>

<div class="container">
    <h1>Agenda Fácil</h1>

    <label>Nome do Cliente</label>
    <input type="text" id="nome">

    <label>Telefone (com DDD)</label>
    <input type="text" id="telefone" placeholder="Ex: 11999999999">

    <label>Data</label>
    <input type="date" id="data">

    <label>Horário</label>
    <input type="time" id="hora">

    <button id="btnAgendar">Agendar e Avisar no WhatsApp</button>

    <div class="agendamentos">
        <h3>Agendamentos do Dia</h3>
        <div id="lista"></div>
    </div>

    <div class="footer">
        Sistema Beta • Espaço Klebylenne Moraes
    </div>
</div>

<script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/12.9.0/firebase-app.js";
    import { getFirestore, collection, addDoc, onSnapshot, query, where, doc, deleteDoc, orderBy } from "https://www.gstatic.com/firebasejs/12.9.0/firebase-firestore.js";

    // Suas credenciais
    const firebaseConfig = {
        apiKey: "AIzaSyAxyovmqjNYIzOYYDZZnduquiJQeK4UIgc",
        authDomain: "agendei-d721e.firebaseapp.com",
        projectId: "agendei-d721e",
        storageBucket: "agendei-d721e.firebasestorage.app",
        messagingSenderId: "525023801595",
        appId: "1:525023801595:web:71a6d72e986e6e9e30005e",
        measurementId: "G-YQP41N6MJ3"
    };

    // Inicialização
    const app = initializeApp(firebaseConfig);
    const db = getFirestore(app);
    const agendamentosRef = collection(db, "agendamentos");

    // Elementos
    const btnAgendar = document.getElementById('btnAgendar');
    const listaDiv = document.getElementById('lista');
    const inputData = document.getElementById('data');

    // 1. FUNÇÃO AGENDAR (Salva no Firebase + WhatsApp)
    btnAgendar.onclick = async () => {
        const nome = document.getElementById("nome").value;
        const telefone = document.getElementById("telefone").value;
        const data = document.getElementById("data").value;
        const hora = document.getElementById("hora").value;

        if (!nome || !telefone || !data || !hora) {
            alert("Preencha todos os campos!");
            return;
        }

        try {
            await addDoc(agendamentosRef, {
                nome,
                telefone,
                data,
                hora,
                timestamp: new Date()
            });

            // Lógica do WhatsApp que você já usava
            const mensagem = `Olá ${nome}, seu horário está confirmado para o dia ${data} às ${hora}.`;
            window.open(`https://wa.me/55${telefone}?text=${encodeURIComponent(mensagem)}`, "_blank");

            // Limpar campos
            document.getElementById("nome").value = "";
            document.getElementById("telefone").value = "";
        } catch (e) {
            alert("Erro ao salvar: " + e);
        }
    };

    // 2. FUNÇÃO LISTAR (Em tempo real)
    // Mostra os agendamentos sempre que a data mudar
    inputData.onchange = () => {
        const dataSelecionada = inputData.value;
        
        // Busca no Firebase filtrando pela data
        const q = query(agendamentosRef, where("data", "==", dataSelecionada), orderBy("hora", "asc"));

        onSnapshot(q, (snapshot) => {
            listaDiv.innerHTML = "";
            snapshot.forEach((docSnap) => {
                const ag = docSnap.data();
                const id = docSnap.id;

                const card = document.createElement('div');
                card.className = 'card';
                card.innerHTML = `
                    <span><strong>${ag.hora}</strong> - ${ag.nome}</span>
                    <button onclick="window.excluirAgendamento('${id}')">Excluir</button>
                `;
                listaDiv.appendChild(card);
            });
        });
    };

    // 3. FUNÇÃO EXCLUIR (Global)
    window.excluirAgendamento = async (id) => {
        if(confirm("Deseja realmente excluir este agendamento?")) {
            await deleteDoc(doc(db, "agendamentos", id));
        }
    };

</script>

</body>
</html>
