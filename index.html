<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Agendei - Espa√ßo Kleblene Moraes</title>
    <style>
        :root {
            --primary: #d4a373;
            --secondary: #faedcd;
            --dark: #1f1f1f;
            --white: #ffffff;
        }
        body { font-family: 'Segoe UI', sans-serif; background-color: #fefae0; margin: 0; padding: 20px; color: var(--dark); }
        .container { max-width: 500px; margin: 0 auto; background: var(--white); padding: 20px; border-radius: 15px; box-shadow: 0 4px 15px rgba(0,0,0,0.1); }
        h2 { text-align: center; color: var(--primary); }
        .form-group { margin-bottom: 15px; }
        label { display: block; margin-bottom: 5px; font-weight: bold; }
        input, select { width: 100%; padding: 10px; border: 1px solid #ddd; border-radius: 8px; box-sizing: border-box; }
        button { width: 100%; padding: 12px; background: var(--primary); border: none; color: white; border-radius: 8px; font-size: 16px; cursor: pointer; transition: 0.3s; }
        button:hover { background: #bc8a5f; }
        .lista-agendamentos { margin-top: 30px; }
        .card { background: #fff; border-left: 5px solid var(--primary); padding: 15px; margin-bottom: 10px; border-radius: 5px; box-shadow: 0 2px 5px rgba(0,0,0,0.05); position: relative; }
        .card p { margin: 5px 0; }
        .btn-delete { color: #e74c3c; cursor: pointer; font-size: 0.8em; text-decoration: underline; }
    </style>
</head>
<body>

<div class="container">
    <h2>Agendei - Beta 0.3</h2>
    
    <div class="form-group">
        <label>Nome do Cliente</label>
        <input type="text" id="cliente" placeholder="Ex: Maria Silva">
    </div>
    
    <div class="form-group">
        <label>Servi√ßo</label>
        <select id="servico">
            <option value="Cabelo">Cabelo</option>
            <option value="Manicure">Manicure</option>
            <option value="Sobrancelha">Sobrancelha</option>
            <option value="Outro">Outro</option>
        </select>
    </div>

    <div class="form-group">
        <label>Data e Hora</label>
        <input type="datetime-local" id="dataHora">
    </div>

    <button id="btnAgendar">Confirmar Agendamento</button>

    <div class="lista-agendamentos" id="lista">
        <h3>Pr√≥ximos Hor√°rios</h3>
        </div>
</div>

<script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/12.9.0/firebase-app.js";
    import { getFirestore, collection, addDoc, onSnapshot, query, orderBy, doc, deleteDoc } from "https://www.gstatic.com/firebasejs/12.9.0/firebase-firestore.js";

    // Suas credenciais que voc√™ me enviou
    const firebaseConfig = {
        apiKey: "AIzaSyAxyovmqjNYIzOYYDZZnduquiJQeK4UIgc",
        authDomain: "agendei-d721e.firebaseapp.com",
        projectId: "agendei-d721e",
        storageBucket: "agendei-d721e.firebasestorage.app",
        messagingSenderId: "525023801595",
        appId: "1:525023801595:web:71a6d72e986e6e9e30005e",
        measurementId: "G-YQP41N6MJ3"
    };

    // Inicializar Firebase e Firestore
    const app = initializeApp(firebaseConfig);
    const db = getFirestore(app);
    const agendamentosRef = collection(db, "agendamentos");

    // Elementos da tela
    const btnAgendar = document.getElementById('btnAgendar');
    const lista = document.getElementById('lista');

    // FUN√á√ÉO PARA SALVAR NO FIREBASE
    btnAgendar.onclick = async () => {
        const cliente = document.getElementById('cliente').value;
        const servico = document.getElementById('servico').value;
        const dataHora = document.getElementById('dataHora').value;

        if(cliente && dataHora) {
            try {
                await addDoc(agendamentosRef, {
                    cliente: cliente,
                    servico: servico,
                    dataHora: dataHora,
                    timestamp: new Date()
                });
                alert("Agendamento salvo na nuvem!");
                document.getElementById('cliente').value = '';
            } catch (e) {
                console.error("Erro ao salvar: ", e);
            }
        } else {
            alert("Preencha todos os campos!");
        }
    };

    // FUN√á√ÉO PARA LER DO FIREBASE EM TEMPO REAL
    const q = query(agendamentosRef, orderBy("dataHora", "asc"));
    onSnapshot(q, (snapshot) => {
        lista.innerHTML = '<h3>Pr√≥ximos Hor√°rios</h3>';
        snapshot.forEach((docSnap) => {
            const ag = docSnap.data();
            const id = docSnap.id;
            
            // Formatar data para leitura humana
            const dataFormatada = new Date(ag.dataHora).toLocaleString('pt-BR');

            const card = document.createElement('div');
            card.className = 'card';
            card.innerHTML = `
                <p><strong>${ag.cliente}</strong> - ${ag.servico}</p>
                <p>üìÖ ${dataFormatada}</p>
                <span class="btn-delete" onclick="window.excluirAgendamento('${id}')">Excluir</span>
            `;
            lista.appendChild(card);
        });
    });

    // Fun√ß√£o para excluir (dispon√≠vel globalmente)
    window.excluirAgendamento = async (id) => {
        if(confirm("Deseja desmarcar este hor√°rio?")) {
            await deleteDoc(doc(db, "agendamentos", id));
        }
    };
</script>

</body>
</html>
